<video id="clientVideo" autoplay controls></video>
<script>
const videoElement = document.getElementById('clientVideo');
const roomId = new URLSearchParams(window.location.search).get('id');

// Create a MediaSource object
const mediaSource = new MediaSource();
videoElement.src = URL.createObjectURL(mediaSource);

let sourceBuffer;

mediaSource.addEventListener('sourceopen', () => {
    // Ensure you use the correct MIME type and codec
    sourceBuffer = mediaSource.addSourceBuffer('video/webm; codecs="vp8"'); // or 'vp9'
});

setInterval(() => {
    fetch(`/fetch-video.php?room_id=${roomId}`)
        .then((response) => response.blob())
        .then((blob) => {
            console.log('Received Blob:', blob);
            console.log('Blob size:', blob.size); // Log the size of each chunk

            if (sourceBuffer && !sourceBuffer.updating) {
                // Only append if the buffer is not currently updating
                sourceBuffer.appendBuffer(blob); // Append the video blob to the buffer
            }
        })
        .catch((error) => {
            console.error('Error fetching video blob:', error);
        });
}, 2000); // Fetch new video every 2 seconds
</script>
